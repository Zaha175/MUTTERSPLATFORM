<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mutter Erinnerungsplattform (Final Korrigiert)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* --- CSS Variables --- */
        :root {
            --primary-color: #e91e63;
            --primary-light: #ff6090;
            --primary-dark: #b0003a;
            --secondary-color: #4a90e2;
            --text-color: #333;
            --text-light: #fff;
            --bg-color: #f5f5f5;
            --bg-dark: #121212;
            --card-bg: rgba(255, 255, 255, 0.9);
            --card-bg-dark: rgba(30, 30, 30, 0.85);
            --panel-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            --border-radius-base: 8px;
            --border-radius-large: 10px;
            --gap-base: 15px;
            --gap-large: 20px;
            --gap-xlarge: 30px;
        }

        /* --- Dark Mode Overrides --- */
        .dark-mode {
            --primary-color: #ff4081;
            --primary-light: #ff79b0;
            --primary-dark: #c60055;
            --text-color: #e0e0e0;
            --bg-color: #121212;
            --card-bg: var(--card-bg-dark);
            --panel-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        }

        /* --- Base Styles --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: 100%; /* Base font size for rem/em calculations */
        }

        body {
            font-family: 'Segoe UI', 'Arial', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
            min-height: 100vh;
            overflow-x: hidden; /* Prevent horizontal scroll */
            line-height: 1.6;
        }

        /* --- Background Image --- */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://i.imgur.com/AkVQK3t.jpg'); /* TODO: Replace with relevant image */
            background-size: cover;
            background-position: center;
            /* background-attachment: fixed; Removed for performance */
            opacity: 0.4;
            z-index: -1;
            transition: opacity 0.3s ease;
        }
        .dark-mode::before {
            opacity: 0.2;
        }

        /* --- Header --- */
        .main-header { /* Changed from header to avoid conflict with element */
            background-color: var(--primary-color);
            color: var(--text-light);
            padding: var(--gap-large);
            text-align: center;
            position: relative;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .main-header h1 {
            margin: 0;
            font-size: 2rem;
            letter-spacing: 1px;
        }

        /* --- Main Container --- */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--gap-large);
        }

        /* --- 3D Cube Container --- */
        .cube-section { /* Using section for semantics */
            width: 100%;
            aspect-ratio: 16 / 9; /* Maintain aspect ratio instead of fixed height */
            max-height: 50vh; /* Limit maximum height */
            position: relative;
            margin-bottom: var(--gap-xlarge);
            background-color: var(--card-bg);
            border-radius: var(--border-radius-large);
            box-shadow: var(--panel-shadow);
            overflow: hidden; /* Keep overflow hidden */
        }
        #cubeContainer { /* Target the actual canvas container */
            width: 100%;
            height: 100%;
            display: block; /* Ensure canvas takes full space */
        }
        .error-message {
            padding: var(--gap-large);
            color: var(--primary-dark);
            text-align: center;
        }


        /* --- Menu Navigation --- */
        .menu-navigation { /* Changed from menu-container */
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: var(--gap-base);
            margin-bottom: var(--gap-xlarge);
        }
        .menu-item {
            padding: 15px 20px;
            background-color: var(--primary-color);
            color: white;
            border-radius: var(--border-radius-base);
            cursor: pointer;
            font-weight: bold;
            text-align: center;
            min-width: 180px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, background-color 0.3s ease, box-shadow 0.3s ease;
            border: none; /* Remove default button border */
            border-bottom: 4px solid var(--primary-dark);
            display: flex; /* Align icon and text */
            align-items: center;
            justify-content: center;
        }
        .menu-item:hover,
        .menu-item:focus { /* Add focus style */
            transform: translateY(-5px);
            background-color: var(--primary-light);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2);
            outline: 2px solid var(--primary-light); /* Explicit focus indicator */
            /* outline: none; */ /* Only use if alternative focus style is very clear */
        }
         .menu-item.active { /* Style for active item */
             background-color: var(--primary-dark);
             transform: translateY(-2px);
             box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
         }

        .menu-item i {
            margin-right: 8px;
        }

        /* --- Content Area & Panels --- */
        .content-container {
            margin-top: var(--gap-large);
        }
        .content-panel { /* article element will have this class */
            background-color: var(--card-bg);
            border-radius: var(--border-radius-large);
            padding: var(--gap-large);
            margin-bottom: var(--gap-large);
            box-shadow: var(--panel-shadow);
            display: none; /* Hidden by default */
        }
        .content-panel.active {
            display: block;
            animation: fadeIn 0.5s ease forwards; /* Keep state after animation */
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .content-panel h2 {
            color: var(--primary-color);
            margin-bottom: var(--gap-base);
            padding-bottom: 5px;
            border-bottom: 2px solid var(--primary-light);
            font-size: 1.5rem; /* Use relative units */
        }
        .content-panel h3 {
            margin-top: 1.5em;
            margin-bottom: 0.8em;
            color: var(--primary-dark);
        }
        .content-panel p, .content-panel li {
            margin-bottom: 1em; /* Use em for spacing relative to font size */
        }
        .content-panel ul {
            list-style: disc;
            margin-left: 25px; /* Indent lists */
        }
        .content-panel .external-link-button { /* Style for buttons linking externally */
            margin-right: var(--gap-base);
            margin-top: var(--gap-base);
        }

        /* --- Iframe Styling --- */
        .iframe-container iframe {
             width: 100%;
             height: 500px; /* Consider aspect-ratio or other dynamic sizing */
             border: none;
             border-radius: var(--border-radius-base);
             box-shadow: inset 0 2px 4px rgba(0,0,0,0.1); /* Subtle inset shadow */
         }

        /* --- Gallery --- */
        .gallery {
             display: grid; /* Use Grid */
             grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); /* Responsive columns */
             gap: var(--gap-base);
             margin-top: var(--gap-large);
         }

        .gallery-item { /* figure element will have this class */
             border-radius: var(--border-radius-base);
             overflow: hidden;
             box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
             cursor: pointer;
             transition: transform 0.3s ease, box-shadow 0.3s ease;
             display: flex; /* To contain img and figcaption */
             flex-direction: column;
             background-color: var(--primary-dark); /* BG for caption area */
        }
        .gallery-item:hover,
        .gallery-item:focus { /* Add focus style */
             transform: scale(1.03); /* Slightly less aggressive scale */
             box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
             outline: 2px solid var(--primary-light); /* Focus indicator */
         }

        .gallery-item img {
             width: 100%;
             height: 200px; /* Fixed height for consistency */
             object-fit: cover; /* Cover the area without distortion */
             display: block;
             background-color: #eee; /* Placeholder color while loading */
         }
        .dark-mode .gallery-item img {
             background-color: #444;
         }

        .gallery-item figcaption { /* Replaces gallery-caption div */
             padding: 10px;
             color: white;
             text-align: center;
             font-size: 0.9em;
             flex-grow: 1; /* Allow caption to take space if needed */
        }

        /* --- Modal --- */
        .modal {
             position: fixed;
             inset: 0; /* Replaces top, left, width, height */
             background-color: rgba(0, 0, 0, 0.9);
             display: flex; /* Use flex for centering */
             justify-content: center;
             align-items: center;
             z-index: 1000;
             opacity: 0;
             visibility: hidden;
             transition: opacity 0.3s ease, visibility 0s linear 0.3s; /* Delay visibility change */
             padding: var(--gap-base); /* Add padding around content */
        }
        .modal.active {
             opacity: 1;
             visibility: visible;
             transition: opacity 0.3s ease;
        }

        /* Modal Content Area (Holds image and caption) */
        .modal-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            display: flex; /* Allow image to dictate size */
            flex-direction: column; /* Stack image and caption */
            align-items: center; /* Center image horizontally */
            overflow: hidden; /* Prevent content spillover */
        }

        .modal-image-container { /* Added container for scrolling */
            max-width: 100%;
            max-height: calc(90vh - 60px); /* Adjust based on caption height */
            overflow: auto; /* Allow scrolling if image is too big */
            margin-bottom: var(--gap-base); /* Space for caption */
        }

        .modal-content img {
            display: block; /* Remove extra space below image */
            width: auto; /* Let height control */
            height: auto;
            max-width: 100%;
            max-height: 100%; /* Image fits within scroll container */
            border: 3px solid white;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            object-fit: contain; /* Ensure whole image is visible */
        }

        .modal-caption {
             color: white;
             padding: 10px 20px;
             text-align: center;
             background-color: rgba(0, 0, 0, 0.7); /* Moved BG here */
             width: 100%; /* Take full width of modal-content */
             margin-top: auto; /* Pushes caption down if space allows */
        }

        .modal-close {
             position: absolute;
             top: 10px; /* Closer to edge */
             right: 10px; /* Closer to edge */
             background-color: var(--primary-color);
             color: white;
             width: 40px;
             height: 40px;
             border-radius: 50%;
             display: flex;
             align-items: center;
             justify-content: center;
             cursor: pointer;
             font-size: 1.5rem;
             border: none;
             box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
             transition: background-color 0.3s ease, transform 0.3s ease;
             z-index: 1001; /* Ensure it's above content */
         }
        .modal-close:hover {
             background-color: var(--primary-light);
             transform: rotate(90deg);
         }
        .modal-nav { /* Styles for Next/Prev buttons */
             position: absolute;
             top: 50%;
             transform: translateY(-50%);
             background-color: rgba(0, 0, 0, 0.5);
             color: white;
             border: none;
             border-radius: 50%;
             width: 40px;
             height: 40px;
             font-size: 1.5rem;
             cursor: pointer; /* Added cursor */
             display: flex;
             align-items: center;
             justify-content: center;
             transition: background-color 0.3s ease;
             z-index: 1001;
        }
        .modal-nav:hover {
             background-color: rgba(0, 0, 0, 0.8);
        }
        .modal-prev { left: 15px; }
        .modal-next { right: 15px; }

        /* --- Theme Toggle Button --- */
        .theme-toggle {
             position: absolute;
             top: var(--gap-base);
             right: var(--gap-base);
             background: none;
             border: none;
             color: inherit; /* Inherit color from header */
             font-size: 1.5rem;
             cursor: pointer;
             transition: transform 0.3s ease, color 0.3s ease;
             z-index: 10;
             padding: 5px; /* Easier to click */
             line-height: 1; /* Prevent extra space */
        }
        .theme-toggle:hover {
             transform: scale(1.1) rotate(15deg);
        }

        /* --- Footer --- */
        .main-footer {
            margin-top: var(--gap-xlarge);
            padding: var(--gap-large);
            text-align: center;
            font-size: 0.9em;
            color: #777;
            border-top: 1px solid #ddd;
        }
        .dark-mode .main-footer {
             color: #aaa;
             border-top-color: #444;
         }

        /* --- Responsive Adjustments --- */
        @media (max-width: 768px) {
             .main-header h1 { font-size: 1.6rem; }
             .menu-navigation { gap: 10px; }
             .menu-item {
                 flex-basis: calc(50% - 10px); /* Two columns */
                 min-width: unset;
                 font-size: 0.95em;
                 padding: 12px 15px;
             }
             .cube-section { max-height: 40vh; }
             .gallery { grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); }
             .gallery-item img { height: 150px; }
             .content-panel h2 { font-size: 1.3rem; }
         }

        @media (max-width: 480px) {
             .main-header h1 { font-size: 1.4rem; }
             .menu-navigation { gap: 8px; }
             .menu-item {
                 flex-basis: 100%; /* Single column */
                 font-size: 0.9em;
             }
             .cube-section { max-height: 35vh; aspect-ratio: 4/3; } /* Adjust aspect ratio for mobile */
             .gallery { grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); }
             .gallery-item img { height: 120px; }
             .modal-nav { width: 35px; height: 35px; font-size: 1.2rem; }
             .modal-prev { left: 10px; }
             .modal-next { right: 10px; }
         }

    </style>
</head>
<body>
    <header class="main-header">
        <h1>Erinnerungen an Mutter</h1>
        <button class="theme-toggle" id="themeToggle" aria-label="Design umschalten" type="button">
            <i class="fas fa-moon"></i> </button>
    </header>

    <main class="container">
        <section class="cube-section" aria-label="3D Erinnerungswürfel">
            <div id="cubeContainer"></div>
        </section>

        <nav class="menu-navigation" aria-label="Hauptnavigation">
            <button class="menu-item" data-panel="leben" type="button">
                <i class="fas fa-heart" aria-hidden="true"></i> Mutters Leben
            </button>
            <button class="menu-item" data-panel="app" type="button">
                <i class="fas fa-mobile-alt" aria-hidden="true"></i> MutterApp
            </button>
            <button class="menu-item" data-panel="kosten" type="button">
                <i class="fas fa-file-invoice-dollar" aria-hidden="true"></i> Mutterkosten
            </button>
            <button class="menu-item" data-panel="kinder" type="button">
                <i class="fas fa-child" aria-hidden="true"></i> Kinder
            </button>
            <button class="menu-item" data-panel="hobbys" type="button">
                <i class="fas fa-paint-brush" aria-hidden="true"></i> Hobbys
            </button>
            <button class="menu-item" data-panel="pflanzen" type="button">
                <i class="fas fa-seedling" aria-hidden="true"></i> Pflanzen
            </button>
            <button class="menu-item" data-panel="kueche" type="button">
                <i class="fas fa-utensils" aria-hidden="true"></i> Mutters Küche
            </button>
            <button class="menu-item" data-panel="galerie" type="button">
                <i class="fas fa-images" aria-hidden="true"></i> Bildergalerie
            </button>
        </nav>

        <div class="content-container">
            <article class="content-panel" id="leben-panel">
                <h2>Mutters Leben</h2>
                <p>Hier finden Sie Erinnerungen an besondere Momente im Leben unserer Mutter. Ihre Geschichten, wichtige Ereignisse und Lebensweisheiten.</p>
                <p>Geboren am 3. Mai 1935 in Mediasch, Siebenbürgen, hat unsere Mutter viele Lebenserfahrungen gesammelt und Weisheiten an uns weitergegeben. Sie war stets eine starke Persönlichkeit, deren Lächeln jeden Raum erhellte.</p>
                <p>Als junge Frau liebte sie das Tanzen und Singen. Sie erzählte oft von ihrer Kindheit in ihrer Heimatstadt und den Traditionen, die sie mit in ihr eigenes Familienleben brachte.</p>
                <h3>Bilder aus ihrem Leben</h3>
                <div class="gallery">
                    <figure class="gallery-item" data-src="https://pfst.cf2.poecdn.net/base/image/5b9ee48b9f802ecdef99a156c618a470a24e089d2cc2928e7f41e65bcb137635" data-caption="Gemeinsame Zeit auf dem Balkon" tabindex="0">
                        <img src="https://pfst.cf2.poecdn.net/base/image/5b9ee48b9f802ecdef99a156c618a470a24e089d2cc2928e7f41e65bcb137635" alt="Mutter sitzt lächelnd neben jemandem auf einem Balkonstuhl" loading="lazy">
                        <figcaption>Gemeinsame Zeit</figcaption>
                    </figure>
                    <figure class="gallery-item" data-src="https://pfst.cf2.poecdn.net/base/image/be7a24b55d2e44927cbdda76670b5d460b663df7e2b689630dd2410296ff9589" data-caption="Erinnerung an Mama auf der Terrasse" tabindex="0">
                        <img src="https://pfst.cf2.poecdn.net/base/image/be7a24b55d2e44927cbdda76670b5d460b663df7e2b689630dd2410296ff9589" alt="Mutter sitzt entspannt auf einer Terrasse, lächelnd" loading="lazy">
                        <figcaption>Auf der Terrasse</figcaption>
                    </figure>
                    </div>
            </article>

            <article class="content-panel" id="app-panel">
                <h2>MutterApp</h2>
                <p>Hier finden Sie Links zu weiteren Anwendungen und Erinnerungen.</p>
                <button class="menu-item external-link-button" type="button" onclick="window.open('https://zaha175.github.io/MUTTER3D/', '_blank')">
                    <i class="fas fa-cube" aria-hidden="true"></i> 3D Erinnerungen öffnen
                </button>
                <button class="menu-item external-link-button" type="button" onclick="window.open('https://zaha175.github.io/MUTTERAPP/', '_blank')">
                    <i class="fas fa-calculator" aria-hidden="true"></i> Kostenübersicht öffnen
                </button>
            </article>

            <article class="content-panel" id="kosten-panel">
                <h2>Mutterkosten</h2>
                <p>Übersicht über die Kosten im Zusammenhang mit dem Trauerfall (Beispielanwendung).</p>
                <div class="iframe-container">
                    <iframe src="https://zaha175.github.io/MUTTERAPP/" title="Mutter Kosten Übersicht (Beispielanwendung)"></iframe>
                </div>
            </article>

            <article class="content-panel" id="kinder-panel">
                <h2>Kinder</h2>
                <p>Erinnerungen an die Zeit mit ihren Kindern und Enkelkindern.</p>
                <p>Unsere Mutter war stets eine liebevolle und geduldige Person, die für ihre Familie immer Zeit hatte. Die Sonntagnachmittage mit selbstgebackenem Kuchen und Geschichten aus ihrer Jugend sind unvergessliche Erinnerungen.</p>
                <p>Besonders zu Weihnachten zeigte sich ihre Liebe zur Familie in den sorgfältig ausgewählten Geschenken und den traditionellen Gerichten, die nur sie so zubereiten konnte.</p>
            </article>

            <article class="content-panel" id="hobbys-panel">
                <h2>Mutters Hobbys</h2>
                <p>Die Freizeitaktivitäten und Leidenschaften unserer Mutter.</p>
                <p>Das Stricken war eine ihrer größten Leidenschaften. Jedes Jahr zu Weihnachten bekamen alle Familienmitglieder selbstgestrickte Socken oder Schals, die mit viel Liebe gemacht wurden.</p>
                <p>Gartenarbeit war ihr Ausgleich. Besonders stolz war sie auf ihre Rosenbeete und den kleinen Gemüsegarten, aus dem sie frische Zutaten für ihre köstlichen Mahlzeiten erntete.</p>
                <p>Das Sammeln alter Postkarten gehörte ebenfalls zu ihren Hobbys. Sie hatte eine beeindruckende Sammlung von Postkarten aus der ganzen Welt.</p>
            </article>

            <article class="content-panel" id="pflanzen-panel">
                <h2>Mutters Pflanzen</h2>
                <p>Die Pflanzen und der Garten, die unserer Mutter so viel bedeutet haben.</p>
                <p>Ihr Garten war ihre Oase der Ruhe. Dort verbrachte sie viele Stunden damit, ihre Blumen zu pflegen und dem Gezwitscher der Vögel zu lauschen.</p>
                <p>Besonders ihre Orchideen waren ihr Stolz. Sie hatte ein besonderes Händchen für diese anspruchsvollen Pflanzen und konnte selbst die schwierigsten Arten zum Blühen bringen.</p>
                <h3>Bilder aus dem Garten</h3>
                <div class="gallery">
                    <figure class="gallery-item" data-src="https://i.imgur.com/UqYfUna.jpg" data-caption="Blumenwiese im Sommer" tabindex="0">
                        <img src="https://i.imgur.com/UqYfUna.jpg" alt="Bunte Blumenwiese in voller Blüte" loading="lazy">
                        <figcaption>Blumenwiese</figcaption>
                    </figure>
                    <figure class="gallery-item" data-src="https://i.imgur.com/VyZyMie.jpg" data-caption="Rote Mohnblumen" tabindex="0">
                        <img src="https://i.imgur.com/VyZyMie.jpg" alt="Feld mit leuchtend roten Mohnblumen" loading="lazy">
                        <figcaption>Mohnblumen</figcaption>
                    </figure>
                     </div>
            </article>

            <article class="content-panel" id="kueche-panel">
                <h2>Mutters Küche</h2>
                <p>Die kulinarischen Spezialitäten und Rezepte unserer Mutter.</p>
                <p>Ihre Apfelstrudel-Rezepte waren in der ganzen Familie berühmt. Der Duft, der aus der Küche kam, wenn sie einen Apfelstrudel backte, ist unvergesslich.</p>
                <p>Zu besonderen Anlässen bereitete sie traditionelle Familienrezepte zu, die von Generation zu Generation weitergegeben wurden. Besonders ihr Sonntagsbraten war ein Highlight.</p>
                <p>Obwohl sie die Rezepte aufgeschrieben hat, schmeckt es nie ganz so wie bei ihr. Es war ihre besondere Note und Liebe, die sie in jedes Gericht einfließen ließ, die ihre Küche so besonders machte.</p>
            </article>

            <article class="content-panel" id="galerie-panel">
                <h2>Bildergalerie</h2>
                <p>Eine Sammlung von Bildern und Erinnerungen.</p>
                <div class="gallery">
                    <figure class="gallery-item" data-src="https://pfst.cf2.poecdn.net/base/image/be7a24b55d2e44927cbdda76670b5d460b663df7e2b689630dd2410296ff9589" data-caption="Erinnerung an Mama auf der Terrasse" tabindex="0">
                        <img src="https://pfst.cf2.poecdn.net/base/image/be7a24b55d2e44927cbdda76670b5d460b663df7e2b689630dd2410296ff9589" alt="Mutter sitzt entspannt auf einer Terrasse, lächelnd" loading="lazy">
                        <figcaption>Auf der Terrasse</figcaption>
                    </figure>
                    <figure class="gallery-item" data-src="https://pfst.cf2.poecdn.net/base/image/5b9ee48b9f802ecdef99a156c618a470a24e089d2cc2928e7f41e65bcb137635" data-caption="Gemeinsame Zeit auf dem Balkon" tabindex="0">
                        <img src="https://pfst.cf2.poecdn.net/base/image/5b9ee48b9f802ecdef99a156c618a470a24e089d2cc2928e7f41e65bcb137635" alt="Mutter sitzt lächelnd neben jemandem auf einem Balkonstuhl" loading="lazy">
                        <figcaption>Gemeinsame Zeit</figcaption>
                    </figure>
                    <figure class="gallery-item" data-src="https://pfst.cf2.poecdn.net/base/image/94c242d217d30ce70abc2dbafca7e5279a91d259286d41b08be5349ad57b9609" data-caption="Im Krankenhaus" tabindex="0">
                        <img src="https://pfst.cf2.poecdn.net/base/image/94c242d217d30ce70abc2dbafca7e5279a91d259286d41b08be5349ad57b9609" alt="Mutter im Krankenhausbett" loading="lazy">
                        <figcaption>Im Krankenhaus</figcaption>
                    </figure>
                    <figure class="gallery-item" data-src="https://pfst.cf2.poecdn.net/base/image/e0f7b58e8f64ca801771e7a24c4d7ea18042372f73196884962abd85594edbd2" data-caption="Zusammen auf der Terrasse (2)" tabindex="0">
                        <img src="https://pfst.cf2.poecdn.net/base/image/e0f7b58e8f64ca801771e7a24c4d7ea18042372f73196884962abd85594edbd2" alt="Mutter und eine weitere Person auf der Terrasse" loading="lazy">
                        <figcaption>Auf der Terrasse (2)</figcaption>
                    </figure>
                    <figure class="gallery-item" data-src="https://i.imgur.com/UqYfUna.jpg" data-caption="Blumenwiese" tabindex="0">
                        <img src="https://i.imgur.com/UqYfUna.jpg" alt="Bunte Blumenwiese in voller Blüte" loading="lazy">
                        <figcaption>Blumenwiese</figcaption>
                    </figure>
                    <figure class="gallery-item" data-src="https://i.imgur.com/cNOjpnW.jpg" data-caption="Blumenwiese im Wald" tabindex="0">
                         <img src="https://i.imgur.com/cNOjpnW.jpg" alt="Waldlichtung mit blühenden Blumen" loading="lazy">
                         <figcaption>Waldblumen</figcaption>
                    </figure>
                    <figure class="gallery-item" data-src="https://i.imgur.com/VyZyMie.jpg" data-caption="Mohnblumen" tabindex="0">
                         <img src="https://i.imgur.com/VyZyMie.jpg" alt="Feld mit leuchtend roten Mohnblumen" loading="lazy">
                         <figcaption>Mohnblumen</figcaption>
                    </figure>
                    <figure class="gallery-item" data-src="https://i.imgur.com/AkVQK3t.jpg" data-caption="Naturbilder" tabindex="0">
                         <img src="https://i.imgur.com/AkVQK3t.jpg" alt="Landschaftsaufnahme mit Bäumen und Himmel" loading="lazy">
                         <figcaption>Natur</figcaption>
                    </figure>
                    <figure class="gallery-item" data-src="https://i.imgur.com/ehGFCT0.jpg" data-caption="Hintergrund Blumen" tabindex="0">
                         <img src="https://i.imgur.com/ehGFCT0.jpg" alt="Nahaufnahme von bunten Blumen" loading="lazy">
                         <figcaption>Blumen</figcaption>
                    </figure>
                </div>
            </article>
        </div>
    </main>

    <div class="modal" id="imageModal" role="dialog" aria-modal="true" aria-labelledby="modalCaption">
         <button class="modal-close" id="modalClose" aria-label="Schließen" type="button">
             <i class="fas fa-times" aria-hidden="true"></i>
         </button>
         <button class="modal-nav modal-prev" id="modalPrev" aria-label="Vorheriges Bild" type="button">
             <i class="fas fa-chevron-left" aria-hidden="true"></i>
         </button>
         <button class="modal-nav modal-next" id="modalNext" aria-label="Nächstes Bild" type="button">
             <i class="fas fa-chevron-right" aria-hidden="true"></i>
         </button>
         <div class="modal-content">
             <div class="modal-image-container">
                 <img id="modalImage" src="" alt="Bild in Vollansicht">
             </div>
             <div class="modal-caption" id="modalCaption"></div>
         </div>
     </div>


    <footer class="main-footer">
        <p>&copy; 15.03.2025 - Eine Erinnerung an unsere Mutter.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/three@0.140.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.140.0/examples/js/controls/OrbitControls.js"></script>

    <script>
    // IIFE to encapsulate code
    (function() {
        'use strict';

        // --- DOM Element Caching ---
        const DOM = {
            body: document.body,
            header: document.querySelector('.main-header'),
            themeToggleButton: document.getElementById('themeToggle'),
            themeToggleIcon: document.getElementById('themeToggle')?.querySelector('i'),
            cubeContainer: document.getElementById('cubeContainer'),
            menuContainer: document.querySelector('.menu-navigation'),
            contentPanels: document.querySelectorAll('.content-panel'),
            // Galleries are selected dynamically in setupGallery now
            modal: document.getElementById('imageModal'),
            modalImage: document.getElementById('modalImage'),
            modalCaption: document.getElementById('modalCaption'),
            modalCloseButton: document.getElementById('modalClose'),
            modalPrevButton: document.getElementById('modalPrev'),
            modalNextButton: document.getElementById('modalNext')
        };

        // --- State Variables ---
        let scene, camera, renderer, controls;
        let cube, particles;
        let isAutoRotating = true;
        let animationFrameId = null; // To cancel animation frame
        let currentModalImageIndex = 0;
        let galleryItemsData = []; // To store gallery item data {src, caption, element}

        // --- Cube Images Data --- (Moved from global scope)
        const cubeImages = [
            { url: 'https://pfst.cf2.poecdn.net/base/image/be7a24b55d2e44927cbdda76670b5d460b663df7e2b689630dd2410296ff9589', caption: 'Erinnerung an Mama auf der Terrasse' },
            { url: 'https://pfst.cf2.poecdn.net/base/image/5b9ee48b9f802ecdef99a156c618a470a24e089d2cc2928e7f41e65bcb137635', caption: 'Gemeinsame Zeit auf dem Balkon' },
            { url: 'https://pfst.cf2.poecdn.net/base/image/94c242d217d30ce70abc2dbafca7e5279a91d259286d41b08be5349ad57b9609', caption: 'Im Krankenhaus' },
            { url: 'https://pfst.cf2.poecdn.net/base/image/e0f7b58e8f64ca801771e7a24c4d7ea18042372f73196884962abd85594edbd2', caption: 'Zusammen auf der Terrasse' },
            { url: 'https://i.imgur.com/UqYfUna.jpg', caption: 'Blumenwiese' },
            { url: 'https://i.imgur.com/AkVQK3t.jpg', caption: 'Blumen' }
        ];


        // ===========================================
        // --- 3D Cube Logic (Simulated Module) ---
        // ===========================================

        /**
         * @description Initializes the Three.js scene, camera, renderer, lights, and objects.
         */
        function initCube() {
            if (!DOM.cubeContainer || typeof THREE === 'undefined') { // Check if THREE is loaded
                console.error("Cube container not found or Three.js not loaded.");
                if(DOM.cubeContainer) DOM.cubeContainer.innerHTML = '<p class="error-message">3D-Bibliothek konnte nicht geladen werden.</p>';
                return;
            }

            try {
                // Scene Setup
                scene = new THREE.Scene();
                scene.background = new THREE.Color(DOM.body.classList.contains('dark-mode') ? 0x1a1a1a : 0xf0f0f0);

                // Camera Setup
                camera = new THREE.PerspectiveCamera(75, DOM.cubeContainer.clientWidth / DOM.cubeContainer.clientHeight, 0.1, 1000);
                camera.position.z = 7;

                // Renderer Setup
                renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setSize(DOM.cubeContainer.clientWidth, DOM.cubeContainer.clientHeight);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                DOM.cubeContainer.innerHTML = ''; // Clear potential error messages
                DOM.cubeContainer.appendChild(renderer.domElement);

                // Controls Setup
                 if (typeof THREE.OrbitControls === 'undefined') {
                     console.warn("OrbitControls not loaded. Cube interaction will be limited.");
                 } else {
                     controls = new THREE.OrbitControls(camera, renderer.domElement);
                     controls.enableDamping = true;
                     controls.dampingFactor = 0.05;
                     controls.minDistance = 5;
                     controls.maxDistance = 15;
                     controls.enablePan = false;
                      // Stop rotation on interaction start
                     controls.addEventListener('start', () => { isAutoRotating = false; });
                     // Optional: Resume rotation after interaction ends (add timeout)
                     // controls.addEventListener('end', () => { setTimeout(() => { isAutoRotating = true; }, 3000); });
                 }


                // Add Lighting
                setupLighting();
                // Add Particles
                setupParticles();
                // Create Cube
                createCube();
                // Start Animation Loop
                startAnimationLoop();
                // Handle Window Resize
                window.addEventListener('resize', handleWindowResize);

            } catch (error) {
                console.error("Error initializing 3D cube:", error);
                if (DOM.cubeContainer) {
                     DOM.cubeContainer.innerHTML = '<p class="error-message">Der 3D-Würfel konnte nicht geladen werden.</p>';
                 }
            }
        }

        /** @description Sets up the lighting for the scene. */
        function setupLighting() {
            if (!scene) return;
            scene.add(new THREE.AmbientLight(0xffffff, 0.6)); // Base ambient light

            const dirLight = new THREE.DirectionalLight(0xffffff, 1.0);
            dirLight.position.set(5, 10, 7.5);
            scene.add(dirLight);
        }

        /** @description Creates and adds particle effects to the scene. */
        function setupParticles() {
             if (!scene || typeof THREE === 'undefined') return;
             try {
                 const particlesGeometry = new THREE.BufferGeometry();
                 const particlesCnt = 5000;
                 const posArray = new Float32Array(particlesCnt * 3);

                 for (let i = 0; i < particlesCnt * 3; i++) {
                     posArray[i] = (Math.random() - 0.5) * 80;
                 }
                 particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));

                 const particleTextureLoader = new THREE.TextureLoader();
                 particleTextureLoader.load(
                     'https://raw.githubusercontent.com/Kuntal-Das/textures/main/spikey.png',
                     (particleTexture) => {
                         const particleMaterial = new THREE.PointsMaterial({
                             size: 0.1,
                             map: particleTexture,
                             transparent: true,
                             blending: THREE.AdditiveBlending,
                             depthWrite: false,
                             color: 0xffaacc
                         });
                         particles = new THREE.Points(particlesGeometry, particleMaterial);
                         particles.position.z = -10;
                         scene.add(particles);
                    },
                    undefined,
                    (error) => { console.error('Error loading particle texture:', error); }
                 );
             } catch (error) {
                 console.error("Error setting up particles:", error);
             }
        }

        /** @description Creates the main cube with image textures. */
        function createCube() {
            if (!scene || typeof THREE === 'undefined') return;
             const geometry = new THREE.BoxGeometry(6, 6, 6);
             const textureLoader = new THREE.TextureLoader();
             const materials = [];
             let loadedTextures = 0;
             const totalTextures = Math.min(6, cubeImages.length);

            if (totalTextures === 0) { // Handle case with no images
                const defaultMaterial = new THREE.MeshStandardMaterial({ color: 0xcccccc });
                cube = new THREE.Mesh(geometry, defaultMaterial);
                scene.add(cube);
                return;
            }

            // Function to be called when all textures are loaded or errored
            const finalizeCubeCreation = () => {
                 // Fill remaining materials if fewer than 6 images/textures loaded successfully
                 while (materials.length < 6) {
                      materials.push(new THREE.MeshStandardMaterial({ color: 0xcccccc })); // Default gray
                  }
                  // Only create the mesh if it doesn't exist yet
                  if (!cube) {
                      cube = new THREE.Mesh(geometry, materials);
                      cube.rotation.x = 0.2;
                      cube.rotation.y = 0.3;
                      scene.add(cube);
                  } else {
                      // If cube already exists (e.g., due to errors), update materials
                      cube.material = materials;
                      cube.material.needsUpdate = true;
                  }
            };


            for (let i = 0; i < totalTextures; i++) {
                 textureLoader.load(
                     cubeImages[i].url,
                     (texture) => { // onLoad
                         texture.colorSpace = THREE.SRGBColorSpace;
                         texture.minFilter = THREE.LinearFilter;
                         materials[i] = new THREE.MeshStandardMaterial({
                             map: texture,
                             metalness: 0.1,
                             roughness: 0.7,
                         });
                         loadedTextures++;
                         if (loadedTextures === totalTextures) finalizeCubeCreation();
                     },
                     undefined, // onProgress
                     (error) => { // onError
                         console.error(`Error loading texture ${i}:`, cubeImages[i].url, error);
                         materials[i] = new THREE.MeshStandardMaterial({ color: 0xff0000, name: `Error Texture ${i}` }); // Red placeholder
                         loadedTextures++;
                         if (loadedTextures === totalTextures) finalizeCubeCreation();
                     }
                 );
             }
        }

        /** @description Handles window resize events to update camera and renderer. */
        function handleWindowResize() {
            if (!renderer || !camera || !DOM.cubeContainer) return;

            const width = DOM.cubeContainer.clientWidth;
            const height = DOM.cubeContainer.clientHeight;

            camera.aspect = width / height;
            camera.updateProjectionMatrix();

            renderer.setSize(width, height);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        }

        /** @description Animation loop using requestAnimationFrame. */
    function animateCube() {
    if (particles) {
        particles.rotation.x += 0.0002;
        particles.rotation.y += 0.0003;
    }

    // Immer die controls aktualisieren:
    controls.update();

    // Nur automatisch drehen, wenn isAutoRotating true ist:
    if (cube && isAutoRotating) {
        cube.rotation.y += 0.002;
        cube.rotation.x += 0.0005;
    }

    renderer.render(scene, camera);
    animationFrameId = requestAnimationFrame(animateCube);
}

        /** @description Starts the animation loop. */
        function startAnimationLoop() {
             if (animationFrameId) {
                 cancelAnimationFrame(animationFrameId);
             }
             animateCube();
         }

        /** @description Stops the animation loop. */
        function stopAnimationLoop() {
             if (animationFrameId) {
                 cancelAnimationFrame(animationFrameId);
                 animationFrameId = null;
             }
         }

         /**
          * @description Updates cube appearance based on theme.
          * @param {boolean} isDark - Whether dark mode is active.
          */
        function updateCubeTheme(isDark) {
            if (!scene || !renderer) return;
            scene.background = new THREE.Color(isDark ? 0x1a1a1a : 0xf0f0f0);

            // Simplified light adjustment
            scene.traverse((object) => {
                if (object.isAmbientLight) object.intensity = isDark ? 0.5 : 0.6;
                if (object.isDirectionalLight) object.intensity = isDark ? 0.9 : 1.0;
             });
             if (particles && particles.material) {
                 particles.material.color.set(isDark ? 0xff88cc : 0xffaacc);
             }
             // Re-render once if animation isn't running
             if (!animationFrameId && renderer && scene && camera) {
                renderer.render(scene, camera);
             }
         }


        // ========================================
        // --- Menu & Panel Logic (Simulated Module) ---
        // ========================================

        /**
         * @description Shows the specified content panel and hides others. Highlights active menu item.
         * @param {string} panelId - The ID of the panel to show (e.g., 'leben').
         */
        function showPanel(panelId) {
            let panelFound = false;
            DOM.contentPanels.forEach(panel => {
                const isActive = panel.id === `${panelId}-panel`;
                panel.classList.toggle('active', isActive);
                if (isActive) panelFound = true;
            });

            if (!panelFound) {
                 console.warn(`Panel mit ID "${panelId}-panel" nicht gefunden.`);
            }

            // Update active menu item
            DOM.menuContainer?.querySelectorAll('.menu-item').forEach(item => {
                item.classList.toggle('active', item.dataset.panel === panelId);
            });
        }

        /**
         * @description Handles clicks on menu items using event delegation.
         * @param {Event} event - The click event object.
         */
        function handleMenuItemClick(event) {
             const menuItem = event.target.closest('.menu-item');
             if (!menuItem || menuItem.classList.contains('external-link-button')) return;

             const panelId = menuItem.dataset.panel;
             if (panelId) {
                 showPanel(panelId);
             } else {
                 console.warn("Menu item clicked without data-panel attribute:", menuItem);
             }
         }

        /** @description Sets up event listeners for the menu. */
        function setupMenu() {
            DOM.menuContainer?.addEventListener('click', handleMenuItemClick);
        }


        // ========================================
        // --- Gallery & Modal Logic (Simulated Module) ---
        // ========================================

        /**
         * @description Opens the image modal and displays the selected image.
         * @param {number} index - The index of the image to display in the galleryItemsData array.
         */
        function openModal(index) {
             if (index >= 0 && index < galleryItemsData.length) {
                 currentModalImageIndex = index;
                 const item = galleryItemsData[index];

                 if (DOM.modalImage && DOM.modalCaption && DOM.modal) {
                     DOM.modalImage.src = item.src;
                     DOM.modalImage.alt = item.caption || "Galeriebild";
                     DOM.modalCaption.textContent = item.caption || '';
                     DOM.modal.classList.add('active');
                     DOM.body.style.overflow = 'hidden';
                     DOM.modalCloseButton?.focus(); // Focus management
                 } else {
                     console.error("Modal elements not found.");
                 }
             } else {
                 console.warn("Invalid index for openModal:", index);
             }
         }

        /** @description Closes the image modal. */
        function closeModal() {
             if (DOM.modal) {
                 DOM.modal.classList.remove('active');
                 DOM.body.style.overflow = '';
                 // TODO: Restore focus to the element that opened the modal
                 // Example: galleryItemsData[currentModalImageIndex]?.element?.focus();
            }
         }

        /** @description Shows the next image in the modal. */
        function showNextModalImage() {
            if (galleryItemsData.length === 0) return;
            const nextIndex = (currentModalImageIndex + 1) % galleryItemsData.length;
            openModal(nextIndex);
        }

        /** @description Shows the previous image in the modal. */
        function showPrevModalImage() {
            if (galleryItemsData.length === 0) return;
            const prevIndex = (currentModalImageIndex - 1 + galleryItemsData.length) % galleryItemsData.length;
            openModal(prevIndex);
        }


        /**
         * @description Handles keydown events when the modal is open (Escape, Arrows).
         * @param {KeyboardEvent} event - The keyboard event.
         */
        function handleModalKeyDown(event) {
             if (!DOM.modal?.classList.contains('active')) return;

             switch (event.key) {
                 case 'Escape':
                     closeModal();
                     break;
                 case 'ArrowLeft':
                     showPrevModalImage();
                     break;
                 case 'ArrowRight':
                     showNextModalImage();
                     break;
             }
         }

         /**
          * @description Handles clicks within the modal area (close button, nav buttons, backdrop).
          * @param {Event} event - The click event.
          */
         function handleModalClick(event) {
             if (event.target === DOM.modalCloseButton || event.target.closest('.modal-close') === DOM.modalCloseButton) {
                 closeModal();
             } else if (event.target === DOM.modalPrevButton || event.target.closest('.modal-prev') === DOM.modalPrevButton) {
                 showPrevModalImage();
             } else if (event.target === DOM.modalNextButton || event.target.closest('.modal-next') === DOM.modalNextButton) {
                 showNextModalImage();
             } else if (event.target === DOM.modal) {
                 closeModal();
             }
         }


        /** @description Sets up the gallery, collects image data, and attaches event listeners. */
        function setupGallery() {
            galleryItemsData = []; // Reset data array
             document.querySelectorAll('.gallery').forEach(gallery => {
                 const items = gallery.querySelectorAll('.gallery-item');
                 items.forEach(item => {
                     const itemData = {
                         src: item.dataset.src,
                         caption: item.dataset.caption,
                         element: item,
                     };
                     // Add to global list for modal navigation
                     galleryItemsData.push(itemData);

                    // Add keydown listener for Enter/Space to open modal
                     item.addEventListener('keydown', (event) => {
                         if (event.key === 'Enter' || event.key === ' ') {
                             event.preventDefault();
                             const globalIndex = galleryItemsData.findIndex(data => data.element === item);
                             if(globalIndex !== -1) {
                                 // TODO: Store `item` as the element that triggered the modal for focus restore
                                 openModal(globalIndex);
                             }
                         }
                     });
                 });

                // Use event delegation on the gallery container
                 gallery.addEventListener('click', (event) => {
                     const galleryItem = event.target.closest('.gallery-item');
                     if (galleryItem) {
                         const globalIndex = galleryItemsData.findIndex(data => data.element === galleryItem);
                         if (globalIndex !== -1) {
                             // TODO: Store `galleryItem` as the element that triggered the modal for focus restore
                             openModal(globalIndex);
                         }
                     }
                 });
             });

             // Setup Modal listeners only once
             DOM.modal?.addEventListener('click', handleModalClick);
             document.addEventListener('keydown', handleModalKeyDown);
         }


        // ========================================
        // --- Theme Toggle Logic (Simulated Module) ---
        // ========================================

        /** @description Toggles dark mode, updates icon, saves preference, and updates cube theme. */
        function handleThemeToggleClick() {
            const isCurrentlyDark = DOM.body.classList.toggle('dark-mode');
            updateThemeIcon(isCurrentlyDark);
            saveThemeSetting(isCurrentlyDark);
            updateCubeTheme(isCurrentlyDark);
        }

         /**
          * @description Updates the theme toggle button icon.
          * @param {boolean} isDark - Whether dark mode is active.
          */
         function updateThemeIcon(isDark) {
             if (DOM.themeToggleIcon) {
                 DOM.themeToggleIcon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
             }
         }

         /**
          * @description Saves the theme preference to LocalStorage.
          * @param {boolean} isDark - Whether dark mode is active.
          */
         function saveThemeSetting(isDark) {
             try {
                 localStorage.setItem('themePreference', isDark ? 'dark' : 'light');
             } catch (error) {
                 console.warn("Could not save theme preference:", error);
             }
         }

        /** @description Loads theme preference from LocalStorage or system preference on page load. */
        function loadThemeSetting() {
             let isDark = false;
             try {
                 const savedTheme = localStorage.getItem('themePreference');
                 const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

                 if (savedTheme === 'dark') isDark = true;
                 else if (savedTheme === 'light') isDark = false;
                 else isDark = prefersDark; // Fallback to system preference

             } catch (error) {
                 console.warn("Could not load theme preference, defaulting to light:", error);
                 isDark = false; // Default to light on error
             }

             if (isDark) {
                 DOM.body.classList.add('dark-mode');
             } else {
                 DOM.body.classList.remove('dark-mode');
             }
             updateThemeIcon(isDark);
             // Note: Cube theme is updated in initialize() after initCube()
         }

        /** @description Sets up the theme toggle button listener. */
        function setupThemeToggle() {
            DOM.themeToggleButton?.addEventListener('click', handleThemeToggleClick);
        }


        // ========================================
        // --- Initialization ---
        // ========================================

        /**
         * @description Main initialization function.
         */
        function initialize() {
            try {
                 console.log("Initializing Mutter Erinnerungsplattform v2...");

                loadThemeSetting();
                initCube();
                setupMenu();
                setupGallery();
                setupThemeToggle();

                // Initial theme update for the cube *after* it's initialized
                 updateCubeTheme(DOM.body.classList.contains('dark-mode'));

                showPanel('leben'); // Show default panel

                console.log("Initialization complete.");

            } catch (error) {
                 console.error("Fatal Error during initialization:", error);
                 // Display a user-friendly error message covering the whole page potentially
                 DOM.body.innerHTML = `<div style="padding: 30px; text-align: center; color: red;">
                                            <h1>Entschuldigung!</h1>
                                            <p>Beim Laden der Erinnerungsseite ist ein Fehler aufgetreten. Bitte versuchen Sie, die Seite neu zu laden.</p>
                                            <p><small>Details: ${error.message}</small></p>
                                        </div>`;
            }
        }

        // --- Run Initialization ---
        if (document.readyState === 'loading') {
             document.addEventListener('DOMContentLoaded', initialize);
        } else {
             initialize();
        }

    })(); // End IIFE
    </script>
</body>
</html>
